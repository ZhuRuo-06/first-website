<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demo Comment</title>
</head>
<body>

<section id="comments">
  <h3>Komentar</h3>

  <div id="comment-list">Loading...</div>

  <form id="comment-form">
    <input id="name" placeholder="Nama" required>
    <textarea id="message" placeholder="Tulis komentar..." required></textarea>
    <button type="submit">Kirim</button>
  </form>
</section>

<script>
const API = "https://comment-backend-nu.vercel.app/api/comments?path=" + location.pathname;

async function loadComments(){
  const res = await fetch(API);
  const json = await res.json();

  console.log("GET:", json);

  if (!json.comments || !Array.isArray(json.comments)) {
    document.getElementById("comment-list").innerHTML =
      "<p>Belum ada komentar</p>";
    return;
  }

  document.getElementById("comment-list").innerHTML =
    json.comments.map(c => `
      <div class="comment">
        <b>${c.name}</b>
        <p>${c.message}</p>
      </div>
    `).join("");
}

document.getElementById("comment-form").onsubmit = async e => {
  e.preventDefault();

  await fetch(API,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      name: name.value,
      message: message.value
    })
  });

  e.target.reset();
  await loadComments(); // ‚Üê PENTING
};

loadComments();
</script>


</body>
</html>

