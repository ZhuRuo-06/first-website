<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demo Comment</title>
</head>
<body>

<section id="comments">
  <h3>Komentar</h3>

  <div id="comment-list">Loading...</div>

  <form id="comment-form">
    <input id="name" placeholder="Nama" required>
    <textarea id="message" placeholder="Tulis komentar..." required></textarea>
    <button type="submit">Kirim</button>
  </form>
</section>

<script>
const API =
  "https://comment-backend-nu.vercel.app/api/comments?path=" +
  encodeURIComponent(location.pathname);

const list = document.getElementById("comment-list");
const form = document.getElementById("comment-form");
const nameInput = document.getElementById("name");
const messageInput = document.getElementById("message");

async function loadComments() {
  const res = await fetch(API);
  const json = await res.json();

  if (!json.comments || !Array.isArray(json.comments)) {
    list.innerHTML = "<p>Belum ada komentar</p>";
    return;
  }

  list.innerHTML = json.comments
    .map(
      c => `
      <div class="comment">
        <b>${c.name}</b>
        <p>${c.message}</p>
      </div>
    `
    )
    .join("");
}

form.onsubmit = async e => {
  e.preventDefault();

  const payload = {
    name: nameInput.value.trim(),
    message: messageInput.value.trim()
  };

  if (!payload.name || !payload.message) return;

  const res = await fetch(API, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  });

  if (!res.ok) {
    console.error("POST gagal");
    return;
  }

  form.reset();
  await loadComments(); // realtime
};

loadComments();
</script>



</body>
</html>


